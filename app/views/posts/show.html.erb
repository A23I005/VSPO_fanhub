<!-- app/views/posts/show.html.erb -->
<div class="border p-4 rounded shadow">
  <h1 class="text-xl font-bold mb-2"><%= @post.title %></h1>
  <p class="mb-4"><%= @post.body %></p>

  <% if @post.likes.exists?(user: current_user) %>
    <%= button_to '💔 いいね解除', post_like_path(@post),
        method: :delete,
        title: "この投稿のいいねを解除します",
        class: "bg-red-500 text-white text-xl px-4 py-2 rounded-full hover:bg-red-600" %>
  <% else %>
    <%= button_to '❤️ いいね', post_like_path(@post),
        method: :post,
        title: "この投稿にいいねします",
        class: "bg-pink-500 text-white text-xl px-4 py-2 rounded-full hover:bg-pink-600" %>
  <% end %>

  <p class="mt-2 text-sm text-gray-600">
    <%= @post.likes.count %> 件のいいね
  </p>
  <p class="text-sm text-gray-600">
  <%= @post.comments.count %> 件のコメント
  </p>

</div>
<h2 class="mt-6 text-lg font-semibold">コメント</h2>

<% if user_signed_in? %>
  <%= form_with(model: [@post, Comment.new], local: true) do |form| %>
    <div class="mt-2">
      <%= form.text_area :body, rows: 3, class: "w-full border rounded p-2", placeholder: "コメントを書く…" %>
    </div>
    <div class="mt-2">
      <%= form.submit "コメントする", class: "bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" %>
    </div>
  <% end %>
<% else %>
  <p class="text-sm text-gray-500">ログインするとコメントできます。</p>
<% end %>

<% @post.comments.each do |comment| %>
  <div class="mt-4 border-t pt-2">
    <p class="text-sm text-gray-700"><%= comment.body %></p>
    <p class="text-xs text-gray-500">投稿者: <%= comment.user.email %></p>
    <% if comment.user == current_user %>
      <%= button_to '🗑️ 削除', post_comment_path(@post, comment),
          method: :delete,
          data: { confirm: '本当に削除しますか？' },
          class: "text-red-500 text-sm mt-1" %>
    <% end %>
  </div>
<% end %>